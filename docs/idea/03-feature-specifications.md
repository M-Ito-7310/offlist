# Feature Specifications

## 機能仕様概要

Offlistは**シンプルさ**を最優先としつつ、買い物リストとして必要十分な機能を提供します。各機能は「オフラインでも完璧に動作する」という制約の中で設計されています。

## コア機能

### 1. 買い物リストアイテム管理

#### 1.1 アイテム追加

**概要:** 新しい買い物アイテムをリストに追加

**UI:**
- 入力フォーム: テキストフィールド + カテゴリー選択 + 追加ボタン
- 配置: 画面上部
- プレースホルダー: 「商品名を入力...」

**仕様:**
```typescript
interface AddItemInput {
  name: string;           // 商品名（必須、1-50文字）
  category: Category;     // カテゴリー（デフォルト: 'food'）
  quantity?: number;      // 数量（オプション、1-999）
  memo?: string;          // メモ（オプション、0-100文字）
}
```

**バリデーション:**
- 商品名: 必須、空白のみは不可、最大50文字
- カテゴリー: 'food' | 'daily' | 'other' のいずれか
- 数量: 1以上999以下の整数
- メモ: 最大100文字

**動作:**
1. ユーザーが商品名を入力
2. カテゴリーを選択（デフォルト: 食品）
3. 「追加」ボタンをクリックまたはEnterキー
4. IndexedDBに保存
5. リストの先頭に即座に表示
6. 入力フォームをクリア
7. 成功時に軽いアニメーション

**エラーハンドリング:**
- 空欄エラー: 「商品名を入力してください」（入力フィールド下に赤文字）
- 文字数超過: 「商品名は50文字以内で入力してください」
- DB保存失敗: Toast通知「保存に失敗しました。もう一度お試しください」

---

#### 1.2 アイテム編集

**概要:** 既存アイテムの商品名、カテゴリー、数量、メモを編集

**UI:**
- トリガー: アイテムをタップ（モバイル）またはクリック（デスクトップ）
- モーダル表示: 編集フォーム
- フィールド: 商品名、カテゴリー、数量、メモ
- ボタン: 「保存」「キャンセル」

**動作:**
1. アイテムをタップ
2. モーダルが開き、現在の値が入力済み
3. 編集
4. 「保存」ボタンでIndexedDBを更新
5. リストに即座に反映
6. モーダルを閉じる

**キャンセル:**
- 「キャンセル」ボタン
- モーダル外をタップ
- Escキー

---

#### 1.3 アイテム削除

**概要:** 個別アイテムの削除

**UI:**
- 削除ボタン: 各アイテムの右端に「×」アイコン
- 確認ダイアログ: 「このアイテムを削除しますか?」
- ボタン: 「削除」「キャンセル」

**動作:**
1. 「×」ボタンをタップ
2. 確認ダイアログ表示
3. 「削除」をタップ
4. IndexedDBから削除
5. リストから即座に消える（フェードアウトアニメーション）

**スワイプ削除（拡張機能）:**
- モバイルで左スワイプ
- 削除ボタンが表示
- タップで削除

---

#### 1.4 チェック（購入済みマーク）

**概要:** アイテムを購入済みとしてマーク

**UI:**
- チェックボックス: 各アイテムの左端
- チェック時の視覚的変化:
  - テキストに取り消し線
  - 薄いグレー表示
  - チェックボックスにチェックマーク

**動作:**
1. チェックボックスをタップ
2. `checked` プロパティを `true` に更新
3. 即座に視覚的変化
4. IndexedDBに保存

**チェック解除:**
- 同じチェックボックスを再度タップ
- `checked` を `false` に戻す

---

### 2. カテゴリー機能

#### 2.1 カテゴリー定義

```typescript
type Category = 'food' | 'daily' | 'other';

const CATEGORY_LABELS: Record<Category, { label: string; emoji: string; color: string }> = {
  food: {
    label: '食品',
    emoji: '🍎',
    color: '#FF9500', // オレンジ
  },
  daily: {
    label: '日用品',
    emoji: '🧴',
    color: '#5856D6', // パープル
  },
  other: {
    label: 'その他',
    emoji: '📦',
    color: '#8E8E93', // グレー
  },
};
```

#### 2.2 カテゴリーフィルター

**概要:** カテゴリー別にアイテムを絞り込み表示

**UI:**
- 位置: 画面上部、追加フォームの下
- 形式: タブ型ボタングループ
- ボタン: 「すべて」「🍎 食品」「🧴 日用品」「📦 その他」

**動作:**
1. カテゴリーボタンをタップ
2. 該当カテゴリーのアイテムのみ表示
3. 「すべて」で全カテゴリー表示

**実装:**
```typescript
const [filter, setFilter] = useState<Category | 'all'>('all');

const filteredItems = items.filter(item =>
  filter === 'all' || item.category === filter
);
```

---

### 3. 完了アイテム管理

#### 3.1 完了アイテムの表示/非表示

**概要:** チェック済みアイテムの表示を切り替え

**UI:**
- トグルボタン: 「完了済みを表示」「完了済みを非表示」
- 位置: リストの下部
- アイコン: 目のアイコン（👁️ / 👁️‍🗨️）

**動作:**
1. トグルボタンをタップ
2. `showCompleted` 状態を切り替え
3. チェック済みアイテムの表示/非表示を切り替え

**デフォルト:** 表示状態

---

#### 3.2 完了アイテム一括削除

**概要:** チェック済みアイテムをまとめて削除

**UI:**
- ボタン: 「完了済みを削除」
- 位置: フッター左側
- スタイル: 危険を示す赤色
- アイコン: ゴミ箱アイコン

**動作:**
1. 「完了済みを削除」ボタンをタップ
2. 確認ダイアログ: 「チェック済みのアイテムをすべて削除しますか?」
3. 「削除」をタップ
4. `checked: true` のアイテムをすべて削除
5. リストから即座に消える

**エッジケース:**
- チェック済みアイテムが0件の場合: ボタンを無効化（グレーアウト）

---

### 4. PWA機能

#### 4.1 ホーム画面へのインストール

**概要:** アプリをホーム画面に追加するプロンプト

**UI:**
- バナー: 画面下部から上にスライドイン
- 内容:
  - タイトル: 「ホーム画面に追加」
  - 説明: 「オフラインでも使える買い物リストアプリ」
  - アイコン: アプリアイコン（128x128）
- ボタン: 「追加」「後で」

**トリガー:**
- 初回訪問時
- 3回目の訪問時（再表示）
- ユーザーが「後で」を選択した場合は24時間後

**動作:**
1. `beforeinstallprompt` イベントを検知
2. イベントを保存
3. バナーを表示
4. 「追加」タップ → ブラウザのインストールプロンプトを表示
5. 「後で」タップ → バナーを非表示

**インストール後:**
- バナーを二度と表示しない
- ホーム画面にアイコンが追加される
- タップでアプリが起動（スタンドアロンモード）

---

#### 4.2 オフライン動作

**概要:** ネットワーク接続なしで完全動作

**実装:**
- **Service Worker**: すべてのリソースをキャッシュ
- **IndexedDB**: データをローカルに保存
- **Cache-First戦略**: 静的リソースはキャッシュから読み込み

**ユーザー体験:**
- オフライン時でもアプリが起動
- アイテムの追加・編集・削除が可能
- データは即座に保存・反映

---

#### 4.3 オンライン状態インジケーター

**概要:** 現在のネットワーク状態を表示

**UI:**
- 位置: フッター右側
- 表示:
  - オンライン: 緑丸 + 「オンライン」
  - オフライン: 赤丸 + 「オフライン」

**動作:**
```typescript
useEffect(() => {
  const handleOnline = () => setIsOnline(true);
  const handleOffline = () => setIsOnline(false);

  window.addEventListener('online', handleOnline);
  window.addEventListener('offline', handleOffline);

  return () => {
    window.removeEventListener('online', handleOnline);
    window.removeEventListener('offline', handleOffline);
  };
}, []);
```

---

### 5. UI/UX詳細仕様

#### 5.1 アニメーション

**追加時:**
- フェードイン + 上からスライド
- duration: 300ms
- easing: ease-out

**削除時:**
- フェードアウト + 右へスライド
- duration: 200ms
- easing: ease-in

**チェック時:**
- スケールアニメーション（1.0 → 1.1 → 1.0）
- duration: 150ms

**実装:**
```typescript
// Tailwind CSS
className="transition-all duration-300 ease-out animate-fadeIn"
```

---

#### 5.2 ローディング状態

**初回ロード:**
- スケルトンスクリーン
- 3-5個のグレーバー

**データ保存中:**
- ボタンにスピナー表示
- ボタンを無効化

---

#### 5.3 エラーハンドリング

**Toast通知:**
- 位置: 画面上部中央
- 表示時間: 3秒
- 自動消滅

**種類:**
- 成功: 緑背景 + チェックアイコン
- エラー: 赤背景 + エラーアイコン
- 警告: 黄色背景 + 警告アイコン

---

#### 5.4 レスポンシブデザイン

**モバイル（< 640px）:**
- フォームは縦並び
- ボタンはフル幅
- タッチ操作に最適化

**タブレット（640px - 1024px）:**
- 2カラムレイアウト
- フォームは横並び

**デスクトップ（> 1024px）:**
- 最大幅600px、中央揃え
- マウスホバー効果

---

## 機能優先度

### MVP（必須）
- ✅ アイテム追加
- ✅ アイテム編集
- ✅ アイテム削除
- ✅ チェック機能
- ✅ カテゴリーフィルター
- ✅ 完了アイテム一括削除
- ✅ PWAインストール
- ✅ オフライン動作
- ✅ オンライン状態表示

### Phase 7以降（将来拡張）
- ⏳ 数量入力
- ⏳ メモ機能
- ⏳ スワイプ削除
- ⏳ ソート機能（名前順、追加順）
- ⏳ 検索機能
- ⏳ アイテムのアーカイブ
- ⏳ リストのエクスポート（CSV）
- ⏳ 複数リスト管理
- ⏳ クラウド同期
- ⏳ 共有機能

---

## 操作フロー例

### 買い物前の準備

```
1. アプリ起動
   ↓
2. 「牛乳」を追加（カテゴリー: 食品）
   ↓
3. 「トイレットペーパー」を追加（カテゴリー: 日用品）
   ↓
4. 「りんご」を追加（カテゴリー: 食品）
   ↓
5. リストに3件表示
```

### 買い物中（オフライン）

```
1. スーパーの地下に入る（圏外）
   ↓
2. ホーム画面からアプリ起動
   ↓
3. 「オフライン」表示を確認
   ↓
4. 「牛乳」をチェック
   ↓
5. 「牛乳」に取り消し線
   ↓
6. 「トイレットペーパー」をチェック
   ↓
7. 「完了済みを非表示」で未購入のみ表示
```

### 買い物後

```
1. 帰宅後、アプリを開く
   ↓
2. 「完了済みを表示」で全アイテム確認
   ↓
3. 「完了済みを削除」でチェック済みアイテムを一括削除
   ↓
4. リストがクリア
```

---

## ユーザビリティ原則

1. **即座のフィードバック**: すべての操作に0.1秒以内の反応
2. **元に戻せる**: 削除は確認ダイアログで誤操作防止
3. **明確な状態表示**: オンライン/オフラインを常に表示
4. **最小限のタップ数**: 追加は1-2タップで完了
5. **エラーの予防**: バリデーションでエラーを防ぐ

---

**このドキュメントの目的**: 開発時の迷いを防ぎ、一貫したUXを実現する

**ドキュメント作成日**: 2025年10月23日
**バージョン**: 1.0
